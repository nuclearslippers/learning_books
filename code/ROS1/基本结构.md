# ROS项目的基本结构和文件的基本写法

## 基本结构
```bash
catkin_ws/                  # 工作空间根目录
├─ src/                      # 所有 ROS 包放在这里
│   ├─ my_robot/             # <== 一个具体的 ROS 包
│   │   ├─ CMakeLists.txt    # 包的构建配置
│   │   ├─ package.xml       # 包的描述文件（依赖、元信息）
│   │   ├─ launch/           # 启动文件 (.launch)
│   │   ├─ src/              # 源代码（cpp/python）
│   │   ├─ scripts/          # Python 可执行脚本（chmod +x）
│   │   ├─ include/my_robot/ # C++ 头文件
│   │   ├─ msg/              # 自定义消息
│   │   ├─ srv/              # 自定义服务
│   │   ├─ urdf/             # 机器人模型
│   │   └─ config/           # 参数文件（.yaml）
│   └─ ...
└─ build/                    # 编译时生成（catkin_make自动生成）
└─ devel/                    # 编译产物及环境设置文件
```

## package.xml
声明包的元信息（包名、版本、依赖关系）
```bash
<package format="2">
    <name>my_robot</name>
    <version>0.0.1</version>
    <description>A simple robot package</description>

    <maintainer email="you@example.com">Your Name</maintainer>
    <license>MIT</license>

    <!-- 必须：构建工具 -->
    <buildtool_depend>catkin</buildtool_depend>

    <!-- 编译时需要 -->
    <build_depend>rospy</build_depend>
    <build_depend>std_msgs</build_depend>

    <!-- 运行依赖 -->
    <exec_depend>rospy</exec_depend>
    <exec_depend>std_msgs</exec_depend>

    <!-- 综合依赖（编译、导出、运行都需要，如果不确定就用这个 -->
    <depend>roscpp</depend>
    <depend>std_msgs</depend>
    </package>
```

## CMakeLists.txt
使用catkin的CMake规则编译源码、生成可执行文件/库。
```cmake
cmake_minimum_required(VERSION 3.0.2) # 要求CMake最低版本
project(my_robot) # 项目名，通常与包名一致

# 依赖包
find_package(catkin REQUIRED)
find_package(catkin REQUIRED COMPONENTS
  roscpp
  std_msgs
)

# 启动 Catkin 功能包
catkin_package()

# 将 src/my_node.cpp 编译成一个名为 my_node 的可执行文件
add_executable(my_node src/my_node.cpp)

# 链接库
target_link_libraries(my_node ${catkin_LIBRARIES}) # my_node 这个可执行文件需要链接哪些库。${catkin_LIBRARIES} 包含了所有在 find_package 中声明的依赖库
```

## launch文件
```xml
<launch>
    <!-- 启动一个节点 -->
    <node pkg="my_robot" type="listener.py" name="listener" output="screen"/>

    <!-- 加载参数 -->
    <param name="robot_speed" value="1.0"/>

    <!-- 从yaml文件加载参数 -->
    <rosparam file="$(find my_robot)/config/params.yaml" command="load"/>

    <!-- 设置环境变量 -->
    <env name="ROS_LOG_DIR" value="$(find my_robot)/logs"/>

    <!-- 包含其他launch文件 -->
    <include file="$(find my_robot)/launch/other.launch"/>

    <!-- 传递参数到被包含的launch -->
    <arg name="use_camera" default="true"/>
</launch>
```
说明：启动一个节点，包括启动节点的相关准备工作。然后rosrun my_robot listener.py （ROS 图中命名为listener，程序结果输出到终端）

## 关于conda环境的问题
```bash
conda activate ros_env
echo "Using Python: $(which python)"
cd ~/catkin_ws
catkin_make -DPYTHON_EXECUTABLE=$(which python) # 要指定运行的python环境
```